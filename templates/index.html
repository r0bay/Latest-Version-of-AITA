<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Random AITA ‚Äî Reader</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <meta name="theme-color" content="#111827" />
  <link rel="manifest" href="/static/manifest.webmanifest">

  <!-- Mobile-first styles -->
  <link rel="stylesheet" href="/static/mobile.css?v=2">


  <!-- (Keep your existing app logic) -->
  <script defer src="/static/app.js?v=14"></script>

  <!-- OPTIONAL: GA4 (leave as-is if you already have it working)
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-BDXP39TTQC"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){ dataLayer.push(arguments); }
    gtag('js', new Date());
    gtag('config', 'G-BDXP39TTQC');
  </script>
  -->
</head>
<body>

  <!-- Sticky top bar -->
  <header class="appbar">
    <div class="appbar-inner">
      <div class="brand">Random Reader</div>

      <div class="sub-select">
        <!-- Subreddit selector (IDs kept the same if you had one) -->
        <select id="subSelect" aria-label="Choose subreddit">
          <option value="AmItheAsshole" selected>r/AmItheAsshole</option>
          <option value="amithebuttface">r/AmITheButtface</option>
          <option value="relationships">r/relationships</option>
        </select>
      </div>

      <a class="donate-chip" href="https://ko-fi.com/" target="_blank" rel="noopener">‚òï Buy me a coffee</a>
    </div>
  </header>

  <main>
    <!-- Collapsed filters -->
    <section class="filters" id="filters">
      <button class="filters-toggle" type="button"
              onclick="document.getElementById('filters').classList.toggle('open')">
        Sort & Filters
      </button>

      <div class="filters-panel">
        <div class="filters-grid">
          <select class="select" id="sortSelect" aria-label="Sort">
            <option value="all" selected>All</option>
            <option value="top">Top</option>
            <option value="new">New</option>
          </select>

          <input class="input" id="kw" placeholder="keywords in title or text" aria-label="Keyword search">
        </div>

        <div class="checkbox-row" style="margin-top:10px">
          <input id="nsfw" type="checkbox">
          <label for="nsfw">Show NSFW</label>
        </div>

        <button class="btn" id="searchBtn" style="margin-top:12px">Search</button>
      </div>
    </section>

    <!-- Post card -->
    <article class="post" id="postCard" aria-live="polite">
      <h1 id="postTitle">Loading‚Ä¶</h1>
      <div class="body" id="postBody">
        <!-- Your JS fills in paragraphs here -->
      </div>

      <!-- TTS controls (IDs preserved in case you already handle them) -->
      <div class="btn-row" style="margin-top:12px">
        <button class="btn" id="ttsRead">üîä Read</button>
        <button class="btn" id="ttsPause">‚è∏ Pause</button>
      </div>

      <!-- Verdict buttons -->
      <div class="btn-row-3" style="margin-top:14px">
        <button class="btn" id="btnYTA">They‚Äôre the Asshole (YTA)</button>
        <button class="btn" id="btnNTA">Not the Asshole (NTA)</button>
        <button class="btn" id="btnESH">Everyone Sucks Here (ESH)</button>
      </div>
    </article>
  </main>

  <!-- Sticky bottom action bar -->
  <div class="sticky-actions">
    <button class="btn primary" id="randomBtn">üé≤ Random</button>
    <a class="btn" id="openReddit" href="#" target="_blank" rel="noopener">Open on Reddit</a>
    <button class="btn" id="shareToggle">Share ‚ñæ</button>
  </div>

  <!-- Tiny UX helpers that won't conflict with your app.js -->
  <script>
    // Smooth iOS focus/scroll
    document.addEventListener('touchstart', ()=>{}, {passive:true});

    // Basic share handler (uses Web Share if available, else clipboard)
    (function () {
      const shareBtn = document.getElementById('shareToggle');
      if (!shareBtn) return;
      shareBtn.addEventListener('click', async () => {
        const url = location.href;
        const title = document.getElementById('postTitle')?.textContent || 'Random AITA';
        try {
          if (navigator.share) {
            await navigator.share({ title, url });
          } else if (navigator.clipboard) {
            await navigator.clipboard.writeText(url);
            const old = shareBtn.textContent;
            shareBtn.textContent = 'Copied!';
            setTimeout(() => shareBtn.textContent = old, 1200);
          }
        } catch {}
      });
    })();

    // If your loader inserts plain text, auto-wrap into paragraphs
    (function normalizeParas() {
      const body = document.getElementById('postBody');
      if (!body) return;
      if (body.children.length === 0 && body.textContent.trim().length) {
        body.innerHTML = body.textContent
          .split(/\n{2,}/).map(p => `<p>${p.trim()}</p>`).join('');
      }
    })();
  </script>
</body>
</html>
